\part{Time Series}
\label{part:Time}


\chapter{Displaying Time Series: Introduction}
\label{cha:timeIntro}

A time series is a sequence of observations registered at consecutive
time instants. When these time instants are evenly spaced, the
distance between them is called the sampling interval. The
visualization of time series is intended to reveal changes of one or
more quantitative variables through time, and to display the
relationships between the variables and their evolution through time.

The standard time series graph displays the time along the horizontal
axis. Several variants of this approach can be found in Chapter
\ref{cha:timeHorizontalAxis}. On the other hand, time can be conceived
as a grouping or conditioning variable (Chapter
\ref{cha:timeGroupFactor}). This solution allows several variables to
be displayed together with a scatterplot, using different panels for
subsets of the data (time as a conditioning variable) or using
different attributes for groups of the data (time as a grouping
variable). Moreover, time can be used as a complementary variable
that adds information to a graph where several variables are
confronted (Chapter \ref{cha:timeComplementary}).

These chapters provide a variety of examples to illustrate a set of
useful techniques. These examples make use of several datasets
(available at the book website) described in Chapter
\ref{cha:dataTime}.

\section{Packages}
\label{sec:time-series-packages}

The CRAN Tasks View ``Time Series Analysis''
\footnote{\url{http://CRAN.R-project.org/view=TimeSeries}} summarizes
the packages for reading, vizualizing, and analyzing time series. This
section provides a brief introduction to the \texttt{zoo} and
\texttt{xts} packages. Most of the information has been extracted from
their vignettes, webpages, and help pages. You should read them for
detailed information.

Both packages extensively use the time classes defined in
\textsf{R}. The interested reader will find an overview of the
different time classes in \textsf{R} in \cite{Ripley.Hornik2001} and
\cite{Grothendieck.Petzoldt2004}.

\subsection{zoo}
\label{sec:zoo}

\index{Packages!zoo@\texttt{zoo}}

The \texttt{zoo} package \cite{Zeileis.Grothendieck2005} provides an
\texttt{S3} class with methods for indexed totally ordered
observations. Its key design goals are independence of a particular
index class and consistency with base \textsf{R} and the \texttt{ts}
class for regular time series.

\index{yearmon@\texttt{yearmon}}
\index{yearqtr@\texttt{yearqtr}}

Objects of class \texttt{zoo} are created by the function \texttt{zoo}
from a numeric vector, matrix, or a factor that is totally ordered by
some index vector. This index is usually a measure of time but every
other numeric, character, or even more abstract vector that provides a
total ordering of the observations is also suitable. It must be noted
that this package defines two new index classes, \texttt{yearmon} and
\texttt{yearqtr}, for representing monthly and quarterly data,
respectively.

The package defines several methods associated with standard generic
functions such as \texttt{print}, \texttt{summary}, \texttt{str},
\texttt{head}, \texttt{tail}, and \texttt{[} (subsetting). In
addition, standard mathematical operations can be performed with
\texttt{zoo} objects, although only for the intersection of the
indexes of the objects.

On the other hand, the data stored in \texttt{zoo} objects can be
extracted with \texttt{coredata}, which drops the index information,
and can be replaced by \texttt{coredata<-}. The index can be extracted
with \texttt{index} or \texttt{time}, and can be modified by
\texttt{index<-}. Finally, the \texttt{window} and \texttt{window<-}
methods extract or replace time windows of \texttt{zoo} objects.

Two \texttt{zoo} objects can be merged by common indexes with
\texttt{merge} and \texttt{cbind}. The \texttt{merge} method combines
the columns of several objects along the union or the intersection of
the indexes. The \texttt{rbind} method combines the indexes (rows) of
the objects.

The \texttt{aggregate} method splits a \texttt{zoo} object into
subsets along a coarser index grid, computes a function (\texttt{sum}
is the default) for each subset, and returns the aggregated
\texttt{zoo} object.

This package provides four methods for dealing with missing
observations:
\begin{enumerate}
\item \texttt{na.omit} removes incomplete observations.
\item \texttt{na.contiguous} extracts the longest consecutive stretch
  of non-missing values.
\item \texttt{na.approx} replaces missing values by linear
  interpolation.
\item \texttt{na.locf} replaces missing observations by the most
  recent non-\texttt{NA} prior to it.
\end{enumerate}

The package defines interfaces to \texttt{read.table} and
\texttt{write.table} for reading, \texttt{read.zoo}, and writing,
\texttt{write.zoo}, \texttt{zoo} series from or to text files.  The
\texttt{read.zoo} function expects either a text file or connection as
input or a \texttt{data.frame}. \texttt{write.zoo} first coerces its
argument to a \texttt{data.frame}, adds a column with the index, and
then calls \texttt{write.table}.


\subsection{xts}
\label{sec:xts}

\index{Packages!xts@\texttt{xts}}

The \texttt{xts} package \cite{Ryan.Ulrich2013} extends the
\texttt{zoo} class definition to provide a general time-series
object. The index of an \texttt{xts} object must be of a time or date
class: \texttt{Date}, \texttt{POSIXct}, \texttt{chron},
\texttt{yearmon}, \texttt{yearqtr}, or \texttt{timeDate}. With this
restriction, the subset operator \texttt{[} is able to extract data
using the
ISO:8601\footnote{\url{http://en.wikipedia.org/wiki/ISO_8601}} time
format notation \texttt{CCYY-MM-DD HH:MM:SS}. It is also possible to
extract a range of times with a \texttt{from/to} notation, where both
from and to are optional. If either side is missing, it is
interpreted as a request to retrieve data from the beginning, or
through the end of the data object.

Furthermore, this package provides several time-based tools:
\begin{itemize}
\item \texttt{endpoints} identifies the endpoints with respect to
  time.
\item \texttt{to.period} changes the periodicity to a coarser time
  index.
\item The functions \lstinline{period.*} and \lstinline{apply.*}
  evaluate a function over a set of non-overlapping time periods.
\end{itemize}


\section{Further Reading}
\label{cha:further-reading-time}

\begin{itemize}

\item \cite{Wills2011} provides a systematic analysis of the
  visualization of time series, and a section of
  \cite{Heer.Bostock.ea2010} summarizes the main techniques to
  display time series.

\item \cite{Cleveland1994} includes a section about time series
  visualization with a detailed discussion of the banking to
  $\SI{45}{\degree}$ technique and the cut-and-stack
  method. \cite{Heer.Agrawala2006} propose the multi-scale banking, a
  technique to identify trends at various frequency scales.

\item \cite{Few2008, Heer.Kong.ea2009} explain in detail the
  foundations of the horizon graph (Section
  \ref{cha:timeHorizontalAxis}).

\item The \emph{small multiples} concept (Sections
  \ref{SEC:sameScale} and \ref{SEC:groupVariable}) is illustrated
  in \cite{Tufte2001,Tufte1990}.

\item Stacked graphs are analyzed in \cite{Byron.Wattenberg2008},
  and the ThemeRiver technique is explained in
  \cite{Havre.Hetzler.ea2002}.

\item \cite{Cleveland1994, Friendly.Denis2005} study the
  scatterplot matrices (Section \ref{SEC:groupVariable}), and
  \cite{Carr.Littlefield.ea1987} provide information about
  hexagonal binning.

\item \cite{Harrower.Fabrikant2008} discuss the use of
  animation for the visualization of data. \cite{Few2007} exposes
  a software tool resembling the Trendalyzer.

\item The \texttt{D3}
  gallery\footnote{\url{https://github.com/mbostock/d3/wiki/Gallery}}
  shows several great examples of time-series visualizations using the
  JavaScript library \texttt{D3.js}.

\end{itemize}

\chapter{Time on the Horizontal Axis}
\label{cha:timeHorizontalAxis}

The most frequent visualization method of a time series uses the
horizontal axis to depict the time index. This chapter illustrates
several variants to display multivariate time series: multiple
time series with different scales, variables with the same scale, and
stacked graphs.

\input{TimeSeries/timeHorizontalAxis}

\chapter{Time as a Conditioning or Grouping Variable}
\label{cha:timeGroupFactor}

In Section \ref{sec:differentVariables} we learned to display the time
evolution of multiple time series with different scales. But, what if
instead of displaying the time evolution we want to confront the
variables between them? Section \ref{SEC:groupVariable} proposes the
scatterplot matrix solution with time as a grouping variable. Section
\ref{SEC:conditionVariable} uses an enhanced scatterplot with time as
a conditioning variable. Section \ref{SEC:hexbin} includes a
digression about the hexagonal binning for large datasets.

\input{TimeSeries/timeGroupFactor}

\chapter{Time as a Complementary Variable}
\label{cha:timeComplementary}

Gapminder\footnote{\url{http://www.gapminder.org/}} is an independent
foundation based in Stockholm, Sweden. Its mission is ``to debunk
devastating myths about the world by offering free access to a
fact-based world view.'' They provide free online tools, data, and
videos ``to better understand the changing world.'' The initial
development of Gapminder was the Trendalyzer software, used by Hans
Rosling in several sequences of his documentary ``The Joy of Stats.''

The information visualization technique used by Trendalyzer is an
interactive bubble chart. By default it shows five variables: two
numeric variables on the vertical and horizontal axes, bubble size and
color, and a time variable that may be manipulated with a slider. The
software uses brushing and linking techniques for displaying the
numeric value of a highlighted country.

This software was acquired by Google\textsuperscript{\textregistered}
in 2007, and is now available as a Motion Chart gadget and as the
Public Data Explorer.

In this chapter, time will be used as a complementary variable which
adds information to a graph where several variables are confronted. We
will illustrate this approach with the evolution of the relationship
between Gross National Income (GNI) and carbon dioxide ($CO_2$)
emissions for a set of countries extracted from the database of the
World Bank Open Data. We will try several solutions to display the
relationship between $CO_2$ emissions and GNI over the years using
time as a complementary variable. The final method will produce an
animated plot resembling the Trendalyzer solution.

\input{TimeSeries/timeComplementary}


\chapter{About the Data}
\label{cha:dataTime}

\input{TimeSeries/dataTime}


%%% Local Variables:
%%% TeX-master: "../main.tex"
%%% End: